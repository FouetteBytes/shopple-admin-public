# =============================================================================
# Kubernetes PersistentVolumeClaims (PVCs)
# =============================================================================
# 
# Defines PersistentVolumeClaims (PVCs) used by containers to retain data
# across pod restarts and deployments.
#
# Purpose
# -------
# - Container filesystems are ephemeral; data is lost on restart.
# - PVCs provide persistent storage that pods can mount.
# - Data stored in PVCs survives restarts and updates.
#
# Working principle
# -----------------
#   Container                    PVC (Storage)
#   ┌─────────────┐             ┌─────────────┐
#   │  Backend    │────mounts───│ backend-data│  (1Gi)
#   │  Container  │             │  /app/data  │
#   └─────────────┘             └─────────────┘
#
# Local vs. cloud
# --------------
# - Local (Docker Desktop/Minikube): uses the workstation disk.
# - Cloud (GKE/EKS/AKS): uses managed cloud storage (e.g., Google Persistent Disk).
#
# =============================================================================

# -----------------------------------------------------------------------------
# Backend data storage
# Stores: notes.json, user data, API key cache.
# -----------------------------------------------------------------------------
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: backend-data
  labels:
    app: backend
spec:
  accessModes:
    - ReadWriteOnce      # Only one pod can write at a time.
  resources:
    requests:
      storage: 1Gi       # 1 gigabyte of storage.

---
# -----------------------------------------------------------------------------
# Crawler output storage
# Stores: scraped product data (JSON/CSV files).
# -----------------------------------------------------------------------------
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: crawler-output
  labels:
    app: crawler
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi       # 5 gigabytes.

---
# -----------------------------------------------------------------------------
# Crawler cache storage
# Stores: temporary crawl data and HTTP cache.
# -----------------------------------------------------------------------------
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: crawler-cache
  labels:
    app: crawler
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi

---
# -----------------------------------------------------------------------------
# Crawler jobs storage
# Stores: job queue files and scheduled tasks.
# -----------------------------------------------------------------------------
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: crawler-jobs
  labels:
    app: crawler
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi

---
# -----------------------------------------------------------------------------
# Crawler logs storage
# Stores: crawler execution logs (before shipping to OpenSearch).
# -----------------------------------------------------------------------------
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: crawler-logs
  labels:
    app: crawler
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
